<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Trip Details - BudgetTrip</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            color: #0f172a;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .liquid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: float 10s infinite ease-in-out;
        }

        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #60a5fa; animation-delay: 0s; }
        .blob-2 { bottom: -10%; right: -10%; width: 400px; height: 400px; background: #3b82f6; animation-delay: 2s; }
        .blob-3 { top: 40%; left: 40%; width: 300px; height: 300px; background: #0ea5e9; animation-delay: 4s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0, 0) scale(1); }
        }

        #map { height: 350px; width: 100%; border-radius: 1rem; z-index: 1; border: 2px solid rgba(37, 99, 235, 0.3); }

        .glass-panel {
            background: rgba(255, 255, 255, 0.55);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px -10px rgba(30, 58, 138, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-panel:hover {
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 15px 50px -10px rgba(30, 58, 138, 0.25);
            border-color: #ffffff;
        }

        .modern-input {
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid #93c5fd;
            color: #172554;
            transition: all 0.3s ease;
        }
        .modern-input:focus {
            background-color: #ffffff;
            border-color: #2563eb;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
            outline: none;
        }

        select.modern-input option {
            background-color: #ffffff;
            color: #1e3a8a;
        }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(37, 99, 235, 0.4); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen pb-10">

<div class="liquid-bg">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
</div>
<nav class="glass-panel rounded-none border-t-0 border-x-0 sticky top-0 z-50 px-6 py-3 flex justify-between items-center shadow-sm bg-white/60">
    <a href="/dashboard" class="flex items-center gap-2 text-slate-700 hover:text-blue-700 transition font-bold text-sm">
        <i class="fa-solid fa-arrow-left"></i> Dashboard
    </a>
    <div class="flex items-center gap-3">
        <a th:href="@{/trips/{id}/export(id=${trip.id})}" class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-2 px-4 rounded-lg shadow-md transition flex items-center gap-2 hover:scale-105 transform border border-blue-500">
            <i class="fa-solid fa-file-arrow-down"></i> Export PDF
        </a>

        <div class="h-6 w-px bg-slate-300/50"></div>

        <div class="flex items-center gap-2">
            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Status</span>
            <span class="bg-green-100 text-green-800 text-xs px-3 py-1 rounded-full font-bold border border-green-200 shadow-sm">Active</span>
        </div>
    </div>
</nav>

<div class="container mx-auto px-4 mt-8 max-w-7xl relative z-10">

    <div class="glass-panel p-6 mb-8 relative overflow-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <div class="lg:col-span-2 flex flex-col justify-between">
                <div>
                    <div class="flex items-center gap-3 mb-3">
                        <h1 class="text-4xl font-bold text-slate-900 flex items-center gap-3 drop-shadow-sm">
                            <span id="startLocText" th:text="${trip.startLocation}">Col</span>
                            <i class="fa-solid fa-arrow-right-long text-blue-600 text-2xl opacity-90"></i>
                            <span id="endLocText" th:text="${trip.endLocation}">Kan</span>
                        </h1>

                        <div id="weatherWidget" class="hidden flex items-center gap-2 bg-white/60 backdrop-blur px-4 py-1.5 rounded-full border border-blue-200 shadow-sm">
                            <img id="weatherIcon" src="" alt="Weather" class="w-6 h-6">
                            <span id="weatherTemp" class="text-sm font-bold text-blue-800">--¬∞C</span>
                        </div>
                    </div>

                    <p class="text-slate-600 text-sm flex items-center gap-4 mb-6">
                        <span class="bg-white/60 px-3 py-1.5 rounded-lg border border-blue-200 shadow-sm font-medium"><i class="fa-regular fa-calendar mr-2 text-blue-600"></i> <span th:text="${trip.startDate}"></span> - <span th:text="${trip.endDate}"></span></span>
                        <span class="bg-white/60 px-3 py-1.5 rounded-lg border border-blue-200 shadow-sm font-medium"><i class="fa-solid fa-route mr-2 text-blue-600"></i> <span th:text="${trip.distanceKm}">0</span> km</span>
                        <input type="hidden" id="rawDistance" th:value="${trip.distanceKm}">
                    </p>
                </div>

                <div class="bg-white/60 p-5 rounded-xl border border-blue-100 shadow-inner">
                    <div class="flex justify-between text-sm mb-2">
                        <span class="font-bold text-slate-700">Budget Usage</span>
                        <span class="font-extrabold tracking-wide" th:classappend="${isOverBudget} ? 'text-red-600' : 'text-slate-900'">
                                Rs. <span th:text="${totalSpent}">0</span> <span class="text-slate-500 text-xs font-semibold">/ <span th:text="${trip.totalBudget}">50000</span></span>
                            </span>
                    </div>
                    <div class="w-full bg-slate-200/80 rounded-full h-3 overflow-hidden shadow-sm">
                        <div class="h-3 rounded-full transition-all duration-1000 ease-out shadow-md"
                             th:classappend="${isOverBudget} ? 'bg-red-500 animate-pulse' : (${isLowBudget} ? 'bg-orange-500' : 'bg-gradient-to-r from-blue-500 to-blue-700')"
                             th:style="'width: ' + ${progress} + '%'"></div>
                    </div>
                    <p th:if="${isOverBudget}" class="text-xs text-red-600 mt-3 font-bold flex items-center gap-2 bg-red-100 p-2 rounded-lg border border-red-200 shadow-sm">
                        <i class="fa-solid fa-circle-exclamation"></i> Warning: Budget Exceeded!
                    </p>
                </div>
            </div>

            <div class="lg:col-span-1 h-64 lg:h-auto">
                <div id="map" class="shadow-lg border border-blue-200 rounded-2xl bg-white"></div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

        <div class="lg:col-span-3">
            <div class="glass-panel p-6 sticky top-24 border-t-4 border-t-blue-500">
                <h3 class="text-lg font-bold text-blue-900 mb-5 flex items-center gap-2">
                    <span class="bg-blue-100 text-blue-700 p-2 rounded-lg text-xs border border-blue-200"><i class="fa-solid fa-plus"></i></span>
                    Add Expense
                </h3>

                <form th:action="@{/trips/{id}/add-expense(id=${trip.id})}" th:object="${newExpense}" method="post">
                    <div class="mb-4">
                        <label class="block text-[10px] font-bold text-blue-800 uppercase mb-1 tracking-wider">Title</label>
                        <input type="text" id="expenseTitle" th:field="*{title}" class="modern-input w-full px-4 py-2.5 rounded-xl text-sm font-medium" placeholder="e.g. Lunch" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-[10px] font-bold text-blue-800 uppercase mb-1 tracking-wider">Category</label>
                        <select id="expenseCategory" th:field="*{category}" class="modern-input w-full px-4 py-2.5 rounded-xl text-sm font-medium">
                            <option value="FLIGHT">‚úàÔ∏è Flight</option>
                            <option value="HOTEL">üè® Hotel</option>
                            <option value="FOOD">üçî Food</option>
                            <option value="ACTIVITY">üì∑ Activity</option>
                            <option value="TRANSPORT">üöï Transport</option>
                            <option value="OTHER">üì¶ Other</option>
                        </select>
                    </div>
                    <div class="mb-5">
                        <label class="block text-[10px] font-bold text-blue-800 uppercase mb-1 tracking-wider">Cost (Rs.)</label>
                        <input type="number" step="0.01" id="expenseCost" th:field="*{cost}" class="modern-input w-full px-4 py-2.5 rounded-xl text-sm font-bold" placeholder="0.00" required>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-3 rounded-xl text-sm shadow-lg transition transform hover:-translate-y-0.5 border border-blue-400">
                        Save Item
                    </button>
                </form>
            </div>
        </div>

        <div class="lg:col-span-6">
            <div class="glass-panel p-6 min-h-[500px]">
                <h3 class="text-lg font-bold text-blue-900 mb-5 flex items-center gap-2">
                    <i class="fa-solid fa-list-check text-blue-500"></i> Expenses
                </h3>

                <div class="space-y-3">
                    <div th:each="expense : ${expenses}" class="group flex items-center justify-between p-4 bg-white/80 border border-blue-100 rounded-2xl hover:shadow-lg transition hover:bg-white hover:border-blue-300 backdrop-blur-sm">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl shadow-sm bg-blue-50 text-blue-500 group-hover:bg-blue-100 group-hover:text-blue-700 transition border border-blue-100">
                                <i th:class="${expense.category == 'FOOD' ? 'fa-solid fa-utensils text-orange-500' :
                                                 (expense.category == 'HOTEL' ? 'fa-solid fa-bed text-purple-500' :
                                                 (expense.category == 'TRANSPORT' ? 'fa-solid fa-car text-blue-600' : 'fa-solid fa-tag text-green-500'))}"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm" th:text="${expense.title}">Title</h4>
                                <p class="text-[10px] text-slate-500 uppercase tracking-wide font-bold" th:text="${expense.category}">Category</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-blue-900 text-base">Rs. <span th:text="${expense.cost}">0.00</span></p>
                            <div class="flex gap-3 justify-end mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-2 group-hover:translate-x-0">
                                <a th:href="@{/trips/{tripId}/expenses/{expenseId}/edit(tripId=${trip.id}, expenseId=${expense.id})}" class="text-blue-600 hover:text-blue-800 text-xs bg-blue-100 p-1.5 rounded-lg border border-blue-200"><i class="fa-solid fa-pen"></i></a>
                                <a th:href="@{/trips/{tripId}/expenses/{expenseId}/remove(tripId=${trip.id}, expenseId=${expense.id})}" onclick="return confirm('Delete?')" class="text-red-500 hover:text-red-700 text-xs bg-red-100 p-1.5 rounded-lg border border-red-200"><i class="fa-solid fa-trash"></i></a>
                            </div>
                        </div>
                    </div>
                    <div th:if="${expenses.empty}" class="text-center py-12 text-slate-500">
                        <div class="bg-blue-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-200">
                            <i class="fa-solid fa-receipt text-3xl opacity-40 text-blue-400"></i>
                        </div>
                        <p class="text-sm font-medium">No expenses yet.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="lg:col-span-3 space-y-6">
            <div class="glass-panel p-6 text-center relative overflow-hidden group"
                 th:classappend="${isOverBudget} ? 'bg-red-50 border-red-200' : (${isLowBudget} ? 'bg-orange-50 border-orange-200' : 'bg-white/70')">
                <p class="text-[10px] font-bold uppercase tracking-widest mb-1 opacity-70 text-slate-600">Remaining</p>
                <h2 class="text-3xl font-black tracking-tight"
                    th:classappend="${isOverBudget} ? 'text-red-500' : 'text-blue-700'">
                    Rs. <span id="walletBalance" th:text="${rawRemaining}">0.00</span>
                </h2>
                <i class="fa-solid fa-wallet absolute -bottom-6 -right-6 text-8xl opacity-10 text-blue-400 transform rotate-12 group-hover:rotate-0 transition duration-500"></i>
            </div>

            <div class="glass-panel p-5">
                <h4 class="font-bold text-slate-700 text-sm mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-lightbulb text-yellow-500 text-lg"></i> Suggestions
                </h4>
                <div class="flex gap-2 mb-3">
                    <input type="text" id="searchBox" placeholder="Search..." class="modern-input w-full px-3 py-2 rounded-lg text-xs">
                    <button onclick="manualSearch()" class="bg-yellow-400 hover:bg-yellow-500 text-slate-900 px-3 rounded-lg text-xs shadow-md transition font-bold"><i class="fa-solid fa-search"></i></button>
                </div>
                <div id="recommendationList" class="space-y-2 max-h-40 overflow-y-auto custom-scroll pr-1">
                    <div class="text-center text-xs text-slate-400 italic py-2">Scanning...</div>
                </div>
            </div>

            <div class="glass-panel p-5 bg-gradient-to-b from-white/80 to-blue-50/80">
                <h4 class="font-bold text-slate-700 text-sm mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-taxi text-blue-600"></i> Transport Calc
                </h4>
                <div class="space-y-3">
                    <div>
                        <label class="text-[10px] font-bold text-blue-500 uppercase">Distance (km)</label>
                        <input type="number" id="calcDistance" class="modern-input w-full px-3 py-1.5 rounded-lg text-xs bg-blue-50 font-bold text-blue-800" readonly>
                    </div>
                    <select id="calcVehicle" onchange="toggleTransportMode()" class="modern-input w-full px-3 py-1.5 rounded-lg text-xs font-medium">
                        <optgroup label="Private">
                            <option value="private-12">Car (12km/l)</option>
                            <option value="private-8">Van (8km/l)</option>
                            <option value="private-40">Bike (40km/l)</option>
                        </optgroup>
                        <optgroup label="Public">
                            <option value="public-5">Bus (Normal)</option>
                            <option value="public-4">Train</option>
                        </optgroup>
                    </select>

                    <div id="fuelInputGroup">
                        <input type="number" id="calcFuelPrice" value="370" oninput="calculateTransport()" class="modern-input w-full px-3 py-1.5 rounded-lg text-xs font-medium" placeholder="Fuel Price">
                    </div>
                    <div id="passengerInputGroup" class="hidden">
                        <input type="number" id="calcPassengers" value="1" min="1" oninput="calculateTransport()" class="modern-input w-full px-3 py-1.5 rounded-lg text-xs font-medium" placeholder="Passengers">
                    </div>

                    <div class="flex items-center gap-2 ml-1">
                        <input type="checkbox" id="calcReturn" onchange="calculateTransport()" class="rounded text-blue-600 focus:ring-blue-600 border-blue-300">
                        <label for="calcReturn" class="text-xs text-slate-600 font-bold">Return Trip</label>
                    </div>

                    <div class="bg-white p-2.5 rounded-xl border border-blue-200 text-center shadow-sm">
                        <span class="text-[10px] text-slate-500 uppercase tracking-wider font-bold">Estimated Cost</span>
                        <p class="font-bold text-blue-600 text-lg">Rs. <span id="calcTotal">0.00</span></p>
                    </div>

                    <button onclick="addTransportExpense()" class="w-full bg-blue-600 text-white text-xs font-bold py-2 rounded-lg hover:bg-blue-700 transition shadow-md border border-blue-500">
                        Add to Expenses
                    </button>
                </div>
            </div>

        </div>

    </div>

</div>

<script th:inline="javascript">
    var startLoc = [[${trip.startLocation}]];
    var endLoc = [[${trip.endLocation}]];
    var rawBalance = parseFloat([[${rawRemaining}]]);

    var map = L.map('map', {zoomControl: false}).setView([7.8731, 80.7718], 7);
    L.control.zoom({ position: 'bottomright' }).addTo(map);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

    var startCoords, endCoords;
    var recMarkers = [];

    function fetchWeather(lat, lon) {
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)
            .then(res => res.json())
            .then(data => {
                if (data.current_weather) {
                    var temp = data.current_weather.temperature;
                    document.getElementById('weatherTemp').innerText = `${temp}¬∞C`;
                    document.getElementById('weatherWidget').classList.remove('hidden');
                    var icon = "https://cdn-icons-png.flaticon.com/512/869/869869.png";
                    if (data.current_weather.weathercode > 3) icon = "https://cdn-icons-png.flaticon.com/512/1163/1163624.png";
                    document.getElementById('weatherIcon').src = icon;
                }
            });
    }

    function initTransportCalc() {
        var rawDist = document.getElementById('rawDistance').value || 0;
        document.getElementById('calcDistance').value = rawDist;
        toggleTransportMode();
    }

    function toggleTransportMode() {
        var selection = document.getElementById('calcVehicle').value;
        var fuelGroup = document.getElementById('fuelInputGroup');
        var passengerGroup = document.getElementById('passengerInputGroup');

        if (selection.startsWith('public')) {
            fuelGroup.classList.add('hidden');
            passengerGroup.classList.remove('hidden');
        } else {
            fuelGroup.classList.remove('hidden');
            passengerGroup.classList.add('hidden');
        }
        calculateTransport();
    }

    function calculateTransport() {
        var dist = parseFloat(document.getElementById('calcDistance').value) || 0;
        var selection = document.getElementById('calcVehicle').value;
        var isReturn = document.getElementById('calcReturn').checked;
        var factor = parseFloat(selection.split('-')[1]);

        var cost = 0;
        if (selection.startsWith('private')) {
            var fuelPrice = parseFloat(document.getElementById('calcFuelPrice').value) || 370;
            if (factor > 0) cost = (dist / factor) * fuelPrice;
        } else {
            var passengers = parseFloat(document.getElementById('calcPassengers').value) || 1;
            cost = dist * factor * passengers;
        }
        if (isReturn) cost *= 2;
        document.getElementById('calcTotal').innerText = cost.toFixed(2);
    }

    function addTransportExpense() {
        var cost = document.getElementById('calcTotal').innerText;
        var selectElem = document.getElementById('calcVehicle');
        var vehicleText = selectElem.options[selectElem.selectedIndex].text.split("(")[0].trim();
        var title = selectElem.value.startsWith('public') ? `${vehicleText} Tickets` : `Fuel (${vehicleText})`;
        if(document.getElementById('calcReturn').checked) title += " (Return)";

        document.getElementById('expenseTitle').value = title;
        document.getElementById('expenseCost').value = cost;
        document.getElementById('expenseCategory').value = 'TRANSPORT';

        document.querySelector('form').scrollIntoView({behavior: 'smooth'});
        document.querySelector('form').classList.add('ring-2', 'ring-blue-500');
        setTimeout(() => document.querySelector('form').classList.remove('ring-2', 'ring-blue-500'), 1000);
    }

    window.addEventListener('load', () => { initTransportCalc(); });

    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(startLoc)}, Sri Lanka&limit=1`)
        .then(res => res.json())
        .then(data => {
            if(data.length > 0) {
                startCoords = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
                L.marker(startCoords).addTo(map).bindPopup("Start: " + startLoc);
                checkRoute();
            }
        });

    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(endLoc)}, Sri Lanka&limit=1`)
        .then(res => res.json())
        .then(data => {
            if(data.length > 0) {
                endCoords = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
                L.marker(endCoords).addTo(map).bindPopup("End: " + endLoc);
                checkRoute();
                fetchAutoRecommendations(endCoords[0], endCoords[1]);
                fetchWeather(endCoords[0], endCoords[1]);
            }
        });

    function checkRoute() {
        if(startCoords && endCoords) {
            var url = `https://router.project-osrm.org/route/v1/driving/${startCoords[1]},${startCoords[0]};${endCoords[1]},${endCoords[0]}?overview=full&geometries=geojson`;
            fetch(url).then(res => res.json()).then(data => {
                if(data.routes && data.routes.length > 0) {
                    var routeLine = L.geoJSON(data.routes[0].geometry, { style: { color: '#3b82f6', weight: 5 } }).addTo(map);
                    map.fitBounds(routeLine.getBounds(), { padding: [50, 50] });
                }
            });
        }
    }

    function fetchAutoRecommendations(lat, lon) {
        var listContainer = document.getElementById('recommendationList');
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`)
            .then(res => res.json())
            .then(data => {
                var city = endLoc;
                if (data && data.address) city = data.address.city || data.address.town || endLoc;
                city = city.replace(" City", "");

                var queries = (rawBalance < 2000 && rawBalance > 0) ?
                    [{ q: "street food", icon: "üå≠", type: "FOOD", min: 200, max: 1000 }] :
                    [{ q: "hotels", icon: "üè®", type: "HOTEL", min: 5000, max: 25000 }];

                listContainer.innerHTML = "";
                queries.forEach(cat => searchAndDisplay(cat.q + " in " + city, cat));
            });
    }

    function searchAndDisplay(queryStr, cat) {
        var listContainer = document.getElementById('recommendationList');
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(queryStr)}&addressdetails=1&limit=3`)
            .then(res => res.json())
            .then(places => {
                if (listContainer.innerHTML.includes("Scanning")) listContainer.innerHTML = "";
                places.forEach(place => {
                    var name = place.display_name.split(",")[0];
                    var price = Math.floor(Math.random() * (cat.max - cat.min + 1)) + cat.min;
                    var card = document.createElement('div');
                    card.className = "p-2 bg-white/70 rounded border border-blue-100 hover:bg-blue-50 cursor-pointer transition text-xs mb-2 backdrop-blur-sm text-slate-700";
                    card.innerHTML = `<div class="font-bold text-slate-800">${cat.icon} ${name}</div><div class="text-green-600 font-bold">Rs. ${price}</div>`;
                    card.onclick = function() {
                        document.getElementById('expenseTitle').value = name;
                        document.getElementById('expenseCost').value = price;
                        document.getElementById('expenseCategory').value = cat.type;
                    };
                    listContainer.appendChild(card);
                });
            });
    }

    function manualSearch() {
        var q = document.getElementById('searchBox').value;
        if(q) {
            document.getElementById('recommendationList').innerHTML = "Searching...";
            searchAndDisplay(q + ", Sri Lanka", { icon: "üìç", type: "ACTIVITY", min: 500, max: 5000 });
        }
    }
</script>
</body>
</html>